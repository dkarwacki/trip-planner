---
import Layout from "../layouts/Layout.astro";
import MapPlanner from "../components/map/MapPlanner";

export const prerender = false;

// Get API key for map display
// Use GOOGLE_MAPS_API_KEY_PUBLIC if available (domain-restricted),
// otherwise fall back to GOOGLE_MAPS_API_KEY
const apiKey = import.meta.env.GOOGLE_MAPS_API_KEY_PUBLIC || import.meta.env.GOOGLE_MAPS_API_KEY;

if (!apiKey) {
  throw new Error(
    "Google Maps API key is not configured. Please set GOOGLE_MAPS_API_KEY or GOOGLE_MAPS_API_KEY_PUBLIC in your .env file."
  );
}

// Optional: Get Map ID for AdvancedMarkerElement support
const mapId = import.meta.env.GOOGLE_MAPS_MAP_ID;

// Get tripId and conversationId from URL params if present
const tripId = Astro.url.searchParams.get("tripId");
const conversationId = Astro.url.searchParams.get("conversationId");
---

<Layout title="Map Planner">
  <MapPlanner client:load apiKey={apiKey} mapId={mapId} tripId={tripId} conversationId={conversationId} />
</Layout>
